@page "/admin/client-config"

@using MudBlazor
@using ScrumMaster.Models
@using ScrumMaster.Dialog
@using ScrumMaster.Services

<MudContainer>
    <MudStack Spacing="2" Class="pa-4">
        <MudText Typo="Typo.h4" Color="Color.Primary">Client Profiles</MudText>
        <MudText Typo="Typo.subtitle1">Manage client details and settings.</MudText>

        <MudIconButton Class="add-btn"
                       Size="Size.Small"
                       Color="Color.Primary"
                       Variant="Variant.Filled"
                       Icon="@Icons.Material.Rounded.Add"
                       OnClick="AddClientAsync" />

        <MudTable Items="@clients" Hover="true" Striped="true" Dense="true">
            <HeaderContent>
                <MudTh>Name</MudTh>
                <MudTh>Code</MudTh>
                <MudTh>Active</MudTh>
                <MudTh>Notes</MudTh>
                <MudTh>Actions</MudTh>
            </HeaderContent>

            <RowTemplate Context="client">
                <MudTd>@client.Name</MudTd>
                <MudTd>@client.Code</MudTd>
                <MudTd>
                    <MudChip T="string"
                             Color="@(@client.IsActive ? Color.Success : Color.Error)"
                             Variant="Variant.Filled">
                        @(@client.IsActive ? "Yes" : "No")
                    </MudChip>
                </MudTd>
                <MudTd>@client.Notes</MudTd>
                <MudTd>
                    <MudButton Variant="Variant.Text" Color="Color.Primary"
                               OnClick="@(() => EditClientAsync(client))">Edit</MudButton>
                    <MudButton Variant="Variant.Text" Color="Color.Error"
                               OnClick="@(() => DeleteClientAsync(client))">Delete</MudButton>

                    <MudButton Variant="Variant.Text" Color="Color.Success"
                               OnClick="@(() => AddProjectAsync(client))">Add Project</MudButton>

                    @if (client.Projects?.Any() == true)
                    {
                        <MudButton Variant="Variant.Text" Color="Color.Secondary"
                                   OnClick="@(() => ToggleProjects(client.Id))">
                            @(ExpandedClients.Contains(client.Id) ? "Hide Projects" : "Show Projects")
                        </MudButton>
                    }
                </MudTd>
            </RowTemplate>

            <ChildRowContent Context="client">
                @if (ExpandedClients.Contains(client.Id) && client.Projects?.Any() == true)
                {
                    <MudTable Items="client.Projects" Dense="true">
                        <HeaderContent>
                            <MudTh>Project Name</MudTh>
                            <MudTh>Description</MudTh>
                            <MudTh>Start Date</MudTh>
                            <MudTh>End Date</MudTh>
                        </HeaderContent>
                        <RowTemplate Context="project">
                            <MudTd>@project.Name</MudTd>
                            <MudTd>@project.Description</MudTd>
                            <MudTd>@project.StartDate?.ToShortDateString()</MudTd>
                            <MudTd>@(project.EndDate?.ToShortDateString() ?? "-")</MudTd>
                        </RowTemplate>
                    </MudTable>
                }
            </ChildRowContent>

            <PagerContent>
                <MudTablePager />
            </PagerContent>
        </MudTable>
    </MudStack>
</MudContainer>