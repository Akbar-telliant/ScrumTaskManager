@page "/home"

@using Microsoft.AspNetCore.Authorization
@using Microsoft.JSInterop
@using MudBlazor
@using ScrumMaster.Models

@inject IJSRuntime JSRuntime

@* Allow only Admin users to access this page *@
@attribute [Authorize(Roles = "Admin, User")]

<!-- Home page displaying Scrum tasks in a table with CRUD functionality -->
<MudPaper Class="pa-2" Elevation="0">

    <!-- Toolbar with Add and Reset buttons -->
    <MudStack Class="pt-4 pb-4 pr-4" Row="true" Justify="Justify.SpaceBetween">
        <MudStack Row="true" Spacing="2">
        <!-- Add new row button -->
        <MudTooltip Text="Add Row">
            <MudIconButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Small"
                           Icon="@Icons.Material.Rounded.Add" OnClick="AddRow" />
        </MudTooltip>

        <!-- Reset all data button -->
        <MudTooltip Text="Reset All">
            <MudIconButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Small"
                           Icon="@Icons.Material.Rounded.Restore" OnClick="ResetData" />
        </MudTooltip>

        <!-- Export data button -->
        <MudTooltip Text="Export to Text">
            <MudIconButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Small"
                           Icon="@Icons.Material.Rounded.Download" OnClick="ExportToText" />
        </MudTooltip>
        </MudStack>
        <MudStack>
        <MudDatePicker Label="Scrum Date" Style="width:300px;" Editable="true" @bind-Date="m_SelectedDate" Mask="@(new DateMask("MM/dd/yyyy"))" DateFormat="MM/dd/yyyy" Placeholder="Date" Variant="Variant.Text" />
        </MudStack>
    </MudStack>  
   

    <!-- Scrum items table -->
    <MudTable Items="Items" Elevation="5" FixedHeader="true" Hover="true" Bordered="true" Striped="true" Dense="true">
        <!-- Table header -->
        <HeaderContent>
            <MudTh>Assigned To</MudTh>
            <MudTh>Project</MudTh>
            <MudTh>Item Id</MudTh>
            <MudTh>Description</MudTh>
            <MudTh>Status</MudTh>
            <MudTh>Actions</MudTh>
        </HeaderContent>

        <!-- Table rows bound to ScrumDetails -->
        <RowTemplate Context="context">

            <!-- Assigned To dropdown -->
            <MudTd>
                <MudSelect T="int" @bind-Value="context.UserId" Dense="true">
                    @foreach (var user in Users)
                    {
                        <MudSelectItem Value="@user.Id">@user.UserName</MudSelectItem>
                    }
                </MudSelect>
            </MudTd>

            <!-- Project dropdown -->
            <MudTd>
                <MudSelect T="int" @bind-Value="context.ProjectId" Dense="true">
                    @foreach (var project in Projects)
                    {
                        <MudSelectItem Value="@project.Id">@project.Name</MudSelectItem>
                    }
                </MudSelect>
            </MudTd>

            <!-- Item Id text field -->
            <MudTd>
                <MudTextField T="string" @bind-Value="context.ItemId" Immediate="true" />
            </MudTd>

            <!-- Description text area -->
            <MudTd>
                <MudTextField T="string" Lines="2" @bind-Value="context.Description" Immediate="true" />
            </MudTd>

            <!-- Status dropdown -->
            <MudTd>
                <MudSelect T="ScrumDetails.ScrumStatus" @bind-Value="context.Status" Dense="true">
                    @foreach (var status in Enum.GetValues<ScrumDetails.ScrumStatus>())
                    {
                        <MudSelectItem Value="@status">@status</MudSelectItem>
                    }
                </MudSelect>
            </MudTd>

            <!-- Row actions: Save and Delete -->
            <MudTh>
               <MudTooltip Text="Remove">
                <MudIconButton Variant="Variant.Text" Size="Size.Small" Icon="@Icons.Material.Rounded.Close" OnClick="() => Remove(context)" />           
               </MudTooltip>
            </MudTh>
        </RowTemplate>
    </MudTable>
   
    <MudStack Row="true" Class="pa-2" Justify="Justify.FlexEnd">
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SaveChanges">
            Save
        </MudButton>     
    </MudStack>
</MudPaper>
